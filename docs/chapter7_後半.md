<style>
.box{
  float: left;
}
.boxContainer{
  overflow: hidden;
}
</style>

# 7 章商品と契約（後半）

## 受注生産

- メーカーは、カスタム品を扱っている

### 標準品

- 仕様が決まっている製品
- 製造→販売→出荷

### カスタム品

- 受注ごとに仕様が異なる製品
- 受注（販売）→仕様定義→製造→出荷

- 標準品の［製造構成明細］や［工程明細］を元に、カスタム品のマスター情報を作成する

### 受注～製造の流れ

1. 受注品用のマスター情報を登録（全体の8割程度カバーできる範囲）
2. 顧客から、カスタム品を受注する
3. 販売品として登録
4. 受注情報を登録
   1. 受注品の仕様明細
   2. 受注品の出荷スケジュール
5. 受注品に対する製造指示
   1. 製造工程の明細
   2. 製造に必要な構成品の明細

### 受注生産のデータモデル比較

<div class="boxContainer">
  <img src="./images/7-20_figure.png" class="box" width="50%">
  <img src="./images/7-21_figure.png" class="box" width="50%">
</div>

- 受注1件ごとに、［受注］レコード作成
- ［受注］テーブルは、［販売品属性］を参照
  - 1つの販売品に対して、0件～複数件の受注を受け得る
  - ［販売品属性］を参照する項目はどれ？※
- ［受注］ごとに、［出荷］レコードを複数件登録
  - 受注後は、必ず、1日～複数日に分けて出荷するスケジュールを立てる
- ［受注］ごとに、［受注別FO明細］を複数件登録
  - 受注品の仕様は、受注ごとに必ず定義される
  - 受注品の属性（フィーチャー）は、［品目別属性明細］と同様に、［品種別フィーチャー］を参照？※
- ［製造指示］テーブルは、［受注］テーブルを参照
  - 受注に対応した、製造指示が作成される
  - 受注が存在しなくても、製造指示が出される場合もある
- ［製造指示］テーブルは、［製造品属性］テーブルを参照
  - 製造品属性に存在しない製造指示を出すことはできない
- ［製造指示］ごとに、［製造指示工程明細］レコードを複数件登録
  - 製造ごとに、必ず製造工程が発生する
  - ［製造指示工程明細］は、［製造工程明細］と同様に、［工程］を参照
- ［製造指示］ごとに、［製造指示構成品明細］レコードを複数件登録
  - 製造ごとに、必ず製造構成品が必要
  - ［製造指示構成品明細］から［製造指示工程明細］への参照関係がないのは、製造工程ごとの構成品を管理しないということ？※

### 受注生産時の考慮

- 不良品が発生するケース
- 受注発生を見越して、事前に作り置きするケース
- 工場の稼働率の調整
- 作業場の負荷
- 構成品の在庫不足

---

## サービスと契約

### サービス業

- 物理的な実体を伴わない商品を扱う
  - 金融サービス
  - デジタルサービス
- 製造業と異なり単品を納入して取引終了する形態ではなく、一定の期間を伴う継続的なサービス提供に対する対価を支払うという契約
- 製造業と同様に、FOモデルを適用できる

### サービス体系のモデル、製造業と比較

<div class="boxContainer">
  <img src="./images/7-10_figure.png" class="box" width="50%">
  <img src="./images/7-22_figure.png" class="box" width="50%">
</div>

- 製造業の場合は、［商品］ごとに［商品別フィーチャー］を作成しなかった
- ［商品］をある程度まとめた概念として［品種区分］を用意して、［品種区分］ごとに［品種別フィーチャー］を用意していた
- 一方で［サービス］は、直接［サービス別フィーチャー］を用意している
- 販売するサービスの特性として、「他サービスと完全に共有できるフィーチャーを持ちづらい」「サービスの数自体がそこまで多くない」などが考えられる？※
- 「OPT値」に応じた「OPT単価」が追加されている
  - 何らかの取引量のレンジで決まる単価を扱う
  - 例）保険サービスにおいて、補償額1億円までなら保険料10万円/月、10億円までなら保険料30万円等？？

### サービス体系と契約のモデル

<div class="boxContainer">
  <img src="./images/7-22_figure.png" class="box" width="50%">
  <img src="./images/7-23_figure.png" class="box" width="50%">
</div>

- 追加されたテーブルは3つ
  - ［契約見出し］テーブル
  - ［契約明細］テーブル
  - ［月次契約サマリ］テーブル

- ［サービス］を一定期間利用することを契約しつつ
- 個別のオプション明細については、［契約明細］テーブルで各「サービス別FO」に対してどのくらいの「OPT値」となるかを決めている
- ［月次契約サマリ］は、財務管理のためのテーブル？※

### もし、FO体系のモデルではなかったら？

- 取引量の多い顧客用にシステムを個別開発
  - 専用のテーブルを設けることになる？
- 似たようなサービスが乱立してしまう

---

## 発注と入荷

- 物販業向けの一般的な発注・入荷に関するモデル

### プロセス指向的なモデリング

- ［発注業務］と［入荷業務］を個別に考える
  - 業務を扱う人が別？※
  - _表現は過激だけど、スケールを大きくすれば、あり得るケースだと思う_
    - _縦割り組織だと、余計にこうなりそう_

<div class="boxContainer">
  <img src="./images/7-25_figure.png" class="box" width="50%">
</div>

- 発注業務に関連して［発注見出し］テーブルと［発注明細］テーブルを用意
- ［発注見出し］テーブルは、［仕入先］テーブルを参照
- ［発注明細］テーブルは、［品目］テーブルを参照

- 入荷業務に関連して［入荷見出し］テーブルと［入荷明細］テーブルを用意
- ［入荷見出し］テーブルは、［仕入先］テーブルを参照
- ［入荷明細］テーブルは、［品目］テーブルを参照

#### 業務フローとデータ更新

- _以下の流れになると思う_

1. 発注業務
   1. 仕入先に、単価と数、納期を指定して、商品の発注を行う
      - 発注するタイミングで［発注見出し］および［発注明細］テーブルを新規登録する
      - ［発注明細］の｢発注残数｣は手計算する
2. 入荷業務
   1. 仕入れ先から、商品を受け取る
        - 入荷するタイミングで［入荷見出し］および［入荷明細］テーブルを新規登録する
        - ［入荷明細］の「入荷単価」「入荷数」は入荷状況に応じて手入力する

#### このモデルの問題点

- ［発注明細］の「発注残数」は、「発注数から入荷数を差し引いた値」であることが明示されていない
- 異なる発注に基づいて同一品目の数量がまとめて入荷されたときの動きも見えない
- 似たような親子関係が何度も現れる「親子頻出」アンチパターン

### 抜本的なモデリング

- 発注・入荷データが本来取るべき形や、在庫システムとの連携が強く意識される
- 発注と入荷が関連づけられている

<div class="boxContainer">
  <img src="./images/7-25_figure.png" class="box" width="50%">
  <img src="./images/7-26_figure.png" class="box" width="50%">
</div>

#### モデルの比較

- ［発注見出し］［入荷見出し］［仕入先］テーブルは変わらない
- ［入荷明細］を［発注明細］テーブルの子テーブルに設定
  - 主キーを「入荷No」から「発注No.、発注行番」に変更、「入荷No.」は参照キーに
- ［入荷明細］テーブルから「入荷単価」を削除
- ［入荷明細］テーブルの「入荷数」を削除して、「入荷予定数」「入荷予定日」「検収数」を追加
- ［発注明細］テーブルから、「発注残数」を削除
- ［発注明細］テーブルに、「確認日」を追加
- ［入荷明細］テーブルに「品目ID」が含まれているのは、代替品を納品されるケースを想定している
  - 発注品目と納入品目が異なる可能性
  - 発注品目が必ず納品されるならば、この項目は不要

#### 業務フローとデータ更新2

- _以下の流れになると思う_

1. 発注業務
   1. 仕入先に、単価と数、希望納期を指定して、商品の発注を行う
      - 発注するタイミングで［発注見出し］および［発注明細］テーブル、［入荷明細］を新規登録する
   2. 仕入先から、納期回答を受け取る
      - ［入荷明細］テーブルの入荷予定日、予定数を更新する
      - ［発注明細］テーブルの確認日を更新する
2. 入荷業務
   1. 仕入れ先から、商品を受け取る
        - 入荷するタイミングで［入荷見出し］を新規登録する
   2. 入荷内容の検収を行う
        - 内容に応じて［入荷明細］を更新する

<div class="boxContainer">
  <img src="./images/7-27_figure.png" class="box" width="50%">
  <img src="./images/7-28_figure.png" class="box" width="50%">
  <img src="./images/7-29_figure.png" class="box" width="50%">
</div>

### 発注単価の決まり方

- 発注単価を事前に契約するケース
  - これまでの書籍内のケースでは、発注時に都度決定していた

<div class="boxContainer">
  <img src="./images/7-30_figure.png" class="box" width="50%">
</div>

---

## 受注と出荷

<div class="boxContainer">
  <img src="./images/7-31_figure.png" class="box" width="50%">
</div>
